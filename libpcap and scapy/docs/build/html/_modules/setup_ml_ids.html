

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>setup_ml_ids &mdash; ML-Based IDS  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=9edc463e" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=b3ba4146"></script>
      <script src="../_static/doctools.js?v=888ff710"></script>
      <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            ML-Based IDS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ML-Based IDS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">setup_ml_ids</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for setup_ml_ids</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Complete setup script for ML-IDS</span>
<span class="sd">Run this first to create all necessary files and directories</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">joblib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">yaml</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.ensemble</span><span class="w"> </span><span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">LabelEncoder</span>

<div class="viewcode-block" id="print_header"><a class="viewcode-back" href="../setup_ml_ids.html#setup_ml_ids.print_header">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">print_header</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Print formatted header&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span></div>

<div class="viewcode-block" id="create_directories"><a class="viewcode-back" href="../setup_ml_ids.html#setup_ml_ids.create_directories">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">create_directories</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create all necessary directories&quot;&quot;&quot;</span>
    <span class="n">print_header</span><span class="p">(</span><span class="s2">&quot;Creating Directories&quot;</span><span class="p">)</span>
    
    <span class="n">directories</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Created directory: </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="create_config_file"><a class="viewcode-back" href="../setup_ml_ids.html#setup_ml_ids.create_config_file">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">create_config_file</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create default configuration file&quot;&quot;&quot;</span>
    <span class="n">print_header</span><span class="p">(</span><span class="s2">&quot;Creating Configuration&quot;</span><span class="p">)</span>
    
    <span class="n">config_content</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;capture&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;interface&#39;</span><span class="p">:</span> <span class="s1">&#39;eth0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="s1">&#39;ip&#39;</span><span class="p">,</span>
            <span class="s1">&#39;promiscuous&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;timeout&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
            <span class="s1">&#39;snaplen&#39;</span><span class="p">:</span> <span class="mi">65535</span><span class="p">,</span>
            <span class="s1">&#39;buffer_size&#39;</span><span class="p">:</span> <span class="mi">1048576</span>
        <span class="p">},</span>
        <span class="s1">&#39;ml&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;model_path&#39;</span><span class="p">:</span> <span class="s1">&#39;models/randomforest_ids.pkl&#39;</span><span class="p">,</span>
            <span class="s1">&#39;scaler_path&#39;</span><span class="p">:</span> <span class="s1">&#39;models/scaler.pkl&#39;</span><span class="p">,</span>
            <span class="s1">&#39;encoder_path&#39;</span><span class="p">:</span> <span class="s1">&#39;models/label_encoder.pkl&#39;</span><span class="p">,</span>
            <span class="s1">&#39;feature_names_path&#39;</span><span class="p">:</span> <span class="s1">&#39;models/feature_names.json&#39;</span><span class="p">,</span>
            <span class="s1">&#39;anomaly_threshold&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
            <span class="s1">&#39;confidence_threshold&#39;</span><span class="p">:</span> <span class="mf">0.6</span>
        <span class="p">},</span>
        <span class="s1">&#39;telegram&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;chat_id&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;cooldown_seconds&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
            <span class="s1">&#39;max_message_length&#39;</span><span class="p">:</span> <span class="mi">4096</span>
        <span class="p">},</span>
        <span class="s1">&#39;processing&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;max_packets_per_flow&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
            <span class="s1">&#39;flow_timeout_seconds&#39;</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span>
            <span class="s1">&#39;min_packets_for_prediction&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;feature_window_size&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
            <span class="s1">&#39;packet_queue_size&#39;</span><span class="p">:</span> <span class="mi">1000</span>
        <span class="p">},</span>
        <span class="s1">&#39;logging&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
            <span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="s1">&#39;logs/ids_service.log&#39;</span><span class="p">,</span>
            <span class="s1">&#39;max_bytes&#39;</span><span class="p">:</span> <span class="mi">10485760</span><span class="p">,</span>
            <span class="s1">&#39;backup_count&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;console_output&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">},</span>
        <span class="s1">&#39;alerts&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;severity_levels&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;CRITICAL&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
                <span class="s1">&#39;HIGH&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
                <span class="s1">&#39;MEDIUM&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                <span class="s1">&#39;LOW&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
                <span class="s1">&#39;INFO&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                <span class="s1">&#39;COOLDOWN&#39;</span><span class="p">:</span> <span class="mi">60</span>
            <span class="p">},</span>
            <span class="s1">&#39;enable_console_alerts&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;enable_file_logging&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;alert_retention_days&#39;</span><span class="p">:</span> <span class="mi">30</span>
        <span class="p">},</span>
        <span class="s1">&#39;attack&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;ddos_threshold&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
            <span class="s1">&#39;portscan_threshold&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
            <span class="s1">&#39;brute_force_threshold&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
            <span class="s1">&#39;malware_threshold&#39;</span><span class="p">:</span> <span class="mf">0.75</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="n">config_path</span> <span class="o">=</span> <span class="s1">&#39;config/config.yaml&#39;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config_content</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Created configuration file: </span><span class="si">{</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Also create a simple JSON config for compatibility</span>
    <span class="n">json_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;model_path&#39;</span><span class="p">:</span> <span class="s1">&#39;models/random_forest_model.pkl&#39;</span><span class="p">,</span>
        <span class="s1">&#39;interface&#39;</span><span class="p">:</span> <span class="s1">&#39;eth0&#39;</span><span class="p">,</span>
        <span class="s1">&#39;filter&#39;</span><span class="p">:</span> <span class="s1">&#39;ip&#39;</span><span class="p">,</span>
        <span class="s1">&#39;promiscuous&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;alert_threshold&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="s1">&#39;log_file&#39;</span><span class="p">:</span> <span class="s1">&#39;logs/ids.log&#39;</span><span class="p">,</span>
        <span class="s1">&#39;alert_file&#39;</span><span class="p">:</span> <span class="s1">&#39;logs/alerts.log&#39;</span><span class="p">,</span>
        <span class="s1">&#39;stats_interval&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="s1">&#39;max_packets_per_batch&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;simulation_mode&#39;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;config/ids_config.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Created JSON config file: config/ids_config.json&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="create_dummy_model"><a class="viewcode-back" href="../setup_ml_ids.html#setup_ml_ids.create_dummy_model">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">create_dummy_model</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a dummy ML model for testing&quot;&quot;&quot;</span>
    <span class="n">print_header</span><span class="p">(</span><span class="s2">&quot;Creating ML Model&quot;</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Generate synthetic training data</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating training data...&quot;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">n_features</span> <span class="o">=</span> <span class="mi">48</span>  <span class="c1"># Matching our feature extractor</span>
        
        <span class="c1"># 80% normal traffic (class 0), 20% attacks (classes 1, 2)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
        
        <span class="c1"># Add some patterns to make it learnable</span>
        <span class="n">X</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>  <span class="c1"># Attack type 1 has higher first 10 features</span>
        <span class="n">X</span><span class="p">[</span><span class="n">y</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span>  <span class="c1"># Attack type 2 has lower features 10-20</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training data shape: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Class distribution: Normal=</span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">, Attack1=</span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">, Attack2=</span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Create and train model</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training Random Forest model...&quot;</span><span class="p">)</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
            <span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
            <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">max_depth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">min_samples_split</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
        <span class="c1"># Create scaler</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        
        <span class="c1"># Create label encoder</span>
        <span class="n">encoder</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
        <span class="n">y_encoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        
        <span class="c1"># Save models</span>
        <span class="n">model_path</span> <span class="o">=</span> <span class="s1">&#39;models/randomforest_ids.pkl&#39;</span>
        <span class="n">scaler_path</span> <span class="o">=</span> <span class="s1">&#39;models/scaler.pkl&#39;</span>
        <span class="n">encoder_path</span> <span class="o">=</span> <span class="s1">&#39;models/label_encoder.pkl&#39;</span>
        
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model_path</span><span class="p">)</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">scaler</span><span class="p">,</span> <span class="n">scaler_path</span><span class="p">)</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">encoder</span><span class="p">,</span> <span class="n">encoder_path</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Saved model: </span><span class="si">{</span><span class="n">model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Saved scaler: </span><span class="si">{</span><span class="n">scaler_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Saved encoder: </span><span class="si">{</span><span class="n">encoder_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Save feature names</span>
        <span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;feature_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_features</span><span class="p">)]</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;models/feature_names.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">feature_names</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Saved feature names: models/feature_names.json&quot;</span><span class="p">)</span>
        
        <span class="c1"># Save metadata</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;n_features&#39;</span><span class="p">:</span> <span class="n">n_features</span><span class="p">,</span>
            <span class="s1">&#39;classes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="s1">&#39;Attack_DoS&#39;</span><span class="p">,</span> <span class="s1">&#39;Attack_Probe&#39;</span><span class="p">],</span>
            <span class="s1">&#39;feature_names&#39;</span><span class="p">:</span> <span class="n">feature_names</span><span class="p">,</span>
            <span class="s1">&#39;attack_mapping&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span> <span class="s1">&#39;Attack_DoS&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span> <span class="s1">&#39;Attack_Probe&#39;</span><span class="p">},</span>
            <span class="s1">&#39;model_info&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
                <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">42</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;models/model_metadata.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Saved model metadata: models/model_metadata.pkl&quot;</span><span class="p">)</span>
        
        <span class="c1"># Test the model</span>
        <span class="n">test_score</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Model trained with accuracy: </span><span class="si">{</span><span class="n">test_score</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="kc">True</span>
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✗ Error creating model: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="create_python_modules"><a class="viewcode-back" href="../setup_ml_ids.html#setup_ml_ids.create_python_modules">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">create_python_modules</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create all Python module files&quot;&quot;&quot;</span>
    <span class="n">print_header</span><span class="p">(</span><span class="s2">&quot;Creating Python Modules&quot;</span><span class="p">)</span>
    
    <span class="c1"># Create __init__.py files</span>
    <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="s1">&#39;logs&#39;</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">]:</span>
        <span class="n">init_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="s1">&#39;__init__.py&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">init_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">init_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# Package initialization</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="n">modules</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;config.py&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&quot;&quot;&quot;</span>
<span class="s1">Configuration module for ML-IDS</span>
<span class="s1">&quot;&quot;&quot;</span>
<span class="s1">import yaml</span>
<span class="s1">import json</span>
<span class="s1">from dataclasses import dataclass, asdict, field</span>
<span class="s1">from typing import Dict, Any, Optional</span>
<span class="s1">from pathlib import Path</span>
<span class="s1">import os</span>

<span class="s1">@dataclass</span>
<span class="s1">class CaptureConfig:</span>
<span class="s1">    &quot;&quot;&quot;Network capture configuration&quot;&quot;&quot;</span>
<span class="s1">    interface: str = &quot;eth0&quot;</span>
<span class="s1">    filter: str = &quot;ip&quot;</span>
<span class="s1">    promiscuous: bool = True</span>
<span class="s1">    timeout: int = 30</span>
<span class="s1">    snaplen: int = 65535</span>
<span class="s1">    buffer_size: int = 1048576</span>

<span class="s1">@dataclass</span>
<span class="s1">class MLConfig:</span>
<span class="s1">    &quot;&quot;&quot;Machine learning model configuration&quot;&quot;&quot;</span>
<span class="s1">    model_path: str = &quot;models/randomforest_ids.pkl&quot;</span>
<span class="s1">    scaler_path: str = &quot;models/scaler.pkl&quot;</span>
<span class="s1">    encoder_path: str = &quot;models/label_encoder.pkl&quot;</span>
<span class="s1">    feature_names_path: str = &quot;models/feature_names.json&quot;</span>
<span class="s1">    anomaly_threshold: float = 0.7</span>
<span class="s1">    confidence_threshold: float = 0.6</span>

<span class="s1">@dataclass</span>
<span class="s1">class TelegramConfig:</span>
<span class="s1">    &quot;&quot;&quot;Telegram bot configuration&quot;&quot;&quot;</span>
<span class="s1">    token: str = &quot;&quot;</span>
<span class="s1">    chat_id: str = &quot;&quot;</span>
<span class="s1">    enabled: bool = True</span>
<span class="s1">    cooldown_seconds: int = 60</span>
<span class="s1">    max_message_length: int = 4096</span>

<span class="s1">@dataclass</span>
<span class="s1">class ProcessingConfig:</span>
<span class="s1">    &quot;&quot;&quot;Packet processing configuration&quot;&quot;&quot;</span>
<span class="s1">    max_packets_per_flow: int = 100</span>
<span class="s1">    flow_timeout_seconds: int = 120</span>
<span class="s1">    min_packets_for_prediction: int = 5</span>
<span class="s1">    feature_window_size: int = 50</span>
<span class="s1">    packet_queue_size: int = 1000</span>

<span class="s1">@dataclass</span>
<span class="s1">class LoggingConfig:</span>
<span class="s1">    &quot;&quot;&quot;Logging configuration&quot;&quot;&quot;</span>
<span class="s1">    level: str = &quot;INFO&quot;</span>
<span class="s1">    file: str = &quot;logs/ids_service.log&quot;</span>
<span class="s1">    max_bytes: int = 10485760</span>
<span class="s1">    backup_count: int = 5</span>
<span class="s1">    console_output: bool = True</span>

<span class="s1">@dataclass</span>
<span class="s1">class AlertConfig:</span>
<span class="s1">    &quot;&quot;&quot;Alert configuration&quot;&quot;&quot;</span>
<span class="s1">    severity_levels: Dict[str, float] = field(default_factory=lambda: {</span>
<span class="s1">        &#39;CRITICAL&#39;: 0.9, &#39;HIGH&#39;: 0.7, &#39;MEDIUM&#39;: 0.5, &#39;LOW&#39;: 0.3, &#39;INFO&#39;: 0.1</span>
<span class="s1">    })</span>
<span class="s1">    enable_console_alerts: bool = True</span>
<span class="s1">    enable_file_logging: bool = True</span>
<span class="s1">    alert_retention_days: int = 30</span>

<span class="s1">@dataclass</span>
<span class="s1">class AttackClassification:</span>
<span class="s1">    &quot;&quot;&quot;Attack classification thresholds&quot;&quot;&quot;</span>
<span class="s1">    ddos_threshold: float = 0.8</span>
<span class="s1">    portscan_threshold: float = 0.6</span>
<span class="s1">    brute_force_threshold: float = 0.7</span>
<span class="s1">    malware_threshold: float = 0.75</span>

<span class="s1">class ConfigManager:</span>
<span class="s1">    &quot;&quot;&quot;Central configuration manager&quot;&quot;&quot;</span>
<span class="s1">    </span>
<span class="s1">    def __init__(self, config_path: str = &quot;config/config.yaml&quot;):</span>
<span class="s1">        self.config_path = config_path</span>
<span class="s1">        self.capture = CaptureConfig()</span>
<span class="s1">        self.ml = MLConfig()</span>
<span class="s1">        self.telegram = TelegramConfig()</span>
<span class="s1">        self.processing = ProcessingConfig()</span>
<span class="s1">        self.logging = LoggingConfig()</span>
<span class="s1">        self.alerts = AlertConfig()</span>
<span class="s1">        self.attack = AttackClassification()</span>
<span class="s1">        </span>
<span class="s1">        if config_path and os.path.exists(config_path):</span>
<span class="s1">            self.load_from_yaml(config_path)</span>
<span class="s1">        else:</span>
<span class="s1">            print(f&quot;Config file </span><span class="si">{config_path}</span><span class="s1"> not found, using defaults&quot;)</span>
<span class="s1">        </span>
<span class="s1">        self.validate_config()</span>
<span class="s1">    </span>
<span class="s1">    def load_from_yaml(self, yaml_path: str):</span>
<span class="s1">        &quot;&quot;&quot;Load configuration from YAML file&quot;&quot;&quot;</span>
<span class="s1">        try:</span>
<span class="s1">            with open(yaml_path, &#39;r&#39;) as f:</span>
<span class="s1">                config_data = yaml.safe_load(f)</span>
<span class="s1">            </span>
<span class="s1">            # Update each configuration section</span>
<span class="s1">            sections = [&#39;capture&#39;, &#39;ml&#39;, &#39;telegram&#39;, &#39;processing&#39;, &#39;logging&#39;, &#39;alerts&#39;, &#39;attack&#39;]</span>
<span class="s1">            for section in sections:</span>
<span class="s1">                if section in config_data and hasattr(self, section):</span>
<span class="s1">                    obj = getattr(self, section)</span>
<span class="s1">                    self._update_dataclass(obj, config_data[section])</span>
<span class="s1">            </span>
<span class="s1">            print(f&quot;Configuration loaded from </span><span class="si">{yaml_path}</span><span class="s1">&quot;)</span>
<span class="s1">        except Exception as e:</span>
<span class="s1">            print(f&quot;Error loading config from </span><span class="si">{yaml_path}</span><span class="s1">: </span><span class="si">{e}</span><span class="s1">&quot;)</span>
<span class="s1">            print(&quot;Using default configuration&quot;)</span>
<span class="s1">    </span>
<span class="s1">    def _update_dataclass(self, dataclass_obj, update_dict: Dict):</span>
<span class="s1">        &quot;&quot;&quot;Update dataclass instance with dictionary values&quot;&quot;&quot;</span>
<span class="s1">        for key, value in update_dict.items():</span>
<span class="s1">            if hasattr(dataclass_obj, key):</span>
<span class="s1">                setattr(dataclass_obj, key, value)</span>
<span class="s1">    </span>
<span class="s1">    def validate_config(self):</span>
<span class="s1">        &quot;&quot;&quot;Validate configuration values&quot;&quot;&quot;</span>
<span class="s1">        # Ensure directories exist</span>
<span class="s1">        Path(&quot;logs&quot;).mkdir(exist_ok=True)</span>
<span class="s1">        Path(&quot;models&quot;).mkdir(exist_ok=True)</span>
<span class="s1">        Path(&quot;config&quot;).mkdir(exist_ok=True)</span>
<span class="s1">        Path(&quot;data&quot;).mkdir(exist_ok=True)</span>
<span class="s1">        </span>
<span class="s1">        # Validate Telegram config</span>
<span class="s1">        if not self.telegram.token or self.telegram.token == &quot;YOUR_TELEGRAM_BOT_TOKEN&quot;:</span>
<span class="s1">            self.telegram.enabled = False</span>
<span class="s1">            print(&quot;Warning: Telegram token not configured, alerts disabled&quot;)</span>
<span class="s1">        </span>
<span class="s1">        # Validate model paths</span>
<span class="s1">        model_files = [</span>
<span class="s1">            (self.ml.model_path, &quot;Model&quot;),</span>
<span class="s1">            (self.ml.scaler_path, &quot;Scaler&quot;),</span>
<span class="s1">            (self.ml.encoder_path, &quot;Encoder&quot;)</span>
<span class="s1">        ]</span>
<span class="s1">        </span>
<span class="s1">        for path, name in model_files:</span>
<span class="s1">            if not Path(path).exists():</span>
<span class="s1">                print(f&quot;Warning: </span><span class="si">{name}</span><span class="s1"> file not found at </span><span class="si">{path}</span><span class="s1">&quot;)</span>
<span class="s1">        </span>
<span class="s1">        print(&quot;Configuration validation complete&quot;)</span>
<span class="s1">    </span>
<span class="s1">    def get_telegram_enabled(self) -&gt; bool:</span>
<span class="s1">        &quot;&quot;&quot;Check if Telegram alerts are enabled&quot;&quot;&quot;</span>
<span class="s1">        return self.telegram.enabled and bool(self.telegram.token and self.telegram.chat_id)</span>
<span class="s1">    </span>
<span class="s1">    def to_dict(self) -&gt; Dict[str, Any]:</span>
<span class="s1">        &quot;&quot;&quot;Convert config to dictionary&quot;&quot;&quot;</span>
<span class="s1">        return {</span>
<span class="s1">            &#39;capture&#39;: asdict(self.capture),</span>
<span class="s1">            &#39;ml&#39;: asdict(self.ml),</span>
<span class="s1">            &#39;telegram&#39;: asdict(self.telegram),</span>
<span class="s1">            &#39;processing&#39;: asdict(self.processing),</span>
<span class="s1">            &#39;logging&#39;: asdict(self.logging),</span>
<span class="s1">            &#39;alerts&#39;: asdict(self.alerts),</span>
<span class="s1">            &#39;attack&#39;: asdict(self.attack)</span>
<span class="s1">        }</span>
<span class="s1">    </span>
<span class="s1">    def save_to_yaml(self, yaml_path: str):</span>
<span class="s1">        &quot;&quot;&quot;Save configuration to YAML file&quot;&quot;&quot;</span>
<span class="s1">        try:</span>
<span class="s1">            config_dict = self.to_dict()</span>
<span class="s1">            with open(yaml_path, &#39;w&#39;) as f:</span>
<span class="s1">                yaml.dump(config_dict, f, default_flow_style=False)</span>
<span class="s1">            print(f&quot;Configuration saved to </span><span class="si">{yaml_path}</span><span class="s1">&quot;)</span>
<span class="s1">        except Exception as e:</span>
<span class="s1">            print(f&quot;Error saving config: </span><span class="si">{e}</span><span class="s1">&quot;)</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span>
        
        <span class="s1">&#39;requirements.txt&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;scapy&gt;=2.5.0</span>
<span class="s1">scikit-learn&gt;=1.0.0</span>
<span class="s1">numpy&gt;=1.21.0</span>
<span class="s1">pandas&gt;=1.3.0</span>
<span class="s1">joblib&gt;=1.1.0</span>
<span class="s1">pyyaml&gt;=6.0</span>
<span class="s1">requests&gt;=2.28.0</span>
<span class="s1">streamlit&gt;=1.12.0</span>
<span class="s1">plotly&gt;=5.10.0&#39;&#39;&#39;</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">modules</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Created: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✓ Already exists: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="create_simple_ids_service"><a class="viewcode-back" href="../setup_ml_ids.html#setup_ml_ids.create_simple_ids_service">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">create_simple_ids_service</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a simple IDS service that works&quot;&quot;&quot;</span>
    <span class="n">print_header</span><span class="p">(</span><span class="s2">&quot;Creating IDS Service&quot;</span><span class="p">)</span>
    
    <span class="n">ids_service_content</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;#!/usr/bin/env python3</span>
<span class="s1">&quot;&quot;&quot;</span>
<span class="s1">Simple ML-IDS Service for testing</span>
<span class="s1">Run this to test your setup</span>
<span class="s1">&quot;&quot;&quot;</span>

<span class="s1">import os</span>
<span class="s1">import sys</span>
<span class="s1">import time</span>
<span class="s1">import json</span>
<span class="s1">import logging</span>
<span class="s1">import asyncio</span>
<span class="s1">from datetime import datetime</span>
<span class="s1">import numpy as np</span>

<span class="s1"># Create directories first</span>
<span class="s1">os.makedirs(&#39;logs&#39;, exist_ok=True)</span>
<span class="s1">os.makedirs(&#39;models&#39;, exist_ok=True)</span>
<span class="s1">os.makedirs(&#39;config&#39;, exist_ok=True)</span>

<span class="s1"># Setup logging</span>
<span class="s1">logging.basicConfig(</span>
<span class="s1">    level=logging.INFO,</span>
<span class="s1">    format=&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;,</span>
<span class="s1">    handlers=[</span>
<span class="s1">        logging.FileHandler(&#39;logs/ids_service.log&#39;),</span>
<span class="s1">        logging.StreamHandler()</span>
<span class="s1">    ]</span>
<span class="s1">)</span>
<span class="s1">logger = logging.getLogger(__name__)</span>

<span class="s1">class SimpleMLIDS:</span>
<span class="s1">    &quot;&quot;&quot;Simple ML-based IDS for testing&quot;&quot;&quot;</span>
<span class="s1">    </span>
<span class="s1">    def __init__(self):</span>
<span class="s1">        logger.info(&quot;Initializing Simple ML-IDS&quot;)</span>
<span class="s1">        </span>
<span class="s1">        # Check for model files</span>
<span class="s1">        self.model_loaded = False</span>
<span class="s1">        self.model_files = [</span>
<span class="s1">            &#39;models/randomforest_ids.pkl&#39;,</span>
<span class="s1">            &#39;models/scaler.pkl&#39;, </span>
<span class="s1">            &#39;models/label_encoder.pkl&#39;</span>
<span class="s1">        ]</span>
<span class="s1">        </span>
<span class="s1">        # Check which files exist</span>
<span class="s1">        for file in self.model_files:</span>
<span class="s1">            if os.path.exists(file):</span>
<span class="s1">                logger.info(f&quot;Found model file: </span><span class="si">{file}</span><span class="s1">&quot;)</span>
<span class="s1">                self.model_loaded = True</span>
<span class="s1">            else:</span>
<span class="s1">                logger.warning(f&quot;Missing model file: </span><span class="si">{file}</span><span class="s1">&quot;)</span>
<span class="s1">        </span>
<span class="s1">        # Statistics</span>
<span class="s1">        self.stats = {</span>
<span class="s1">            &#39;packets_processed&#39;: 0,</span>
<span class="s1">            &#39;anomalies_detected&#39;: 0,</span>
<span class="s1">            &#39;start_time&#39;: time.time(),</span>
<span class="s1">            &#39;packet_rate&#39;: 0</span>
<span class="s1">        }</span>
<span class="s1">        </span>
<span class="s1">        self.running = False</span>
<span class="s1">        </span>
<span class="s1">        if self.model_loaded:</span>
<span class="s1">            logger.info(&quot;ML model files found. System ready.&quot;)</span>
<span class="s1">        else:</span>
<span class="s1">            logger.warning(&quot;Running in simulation mode (no ML model)&quot;)</span>
<span class="s1">    </span>
<span class="s1">    async def simulate_packets(self):</span>
<span class="s1">        &quot;&quot;&quot;Simulate packet processing&quot;&quot;&quot;</span>
<span class="s1">        logger.info(&quot;Starting packet simulation...&quot;)</span>
<span class="s1">        self.running = True</span>
<span class="s1">        </span>
<span class="s1">        packet_count = 0</span>
<span class="s1">        last_update = time.time()</span>
<span class="s1">        </span>
<span class="s1">        try:</span>
<span class="s1">            while self.running:</span>
<span class="s1">                # Simulate packet arrival</span>
<span class="s1">                await asyncio.sleep(0.05)  # ~20 packets/sec</span>
<span class="s1">                </span>
<span class="s1">                packet_count += 1</span>
<span class="s1">                self.stats[&#39;packets_processed&#39;] += 1</span>
<span class="s1">                </span>
<span class="s1">                # Update packet rate every second</span>
<span class="s1">                current_time = time.time()</span>
<span class="s1">                if current_time - last_update &gt;= 1.0:</span>
<span class="s1">                    self.stats[&#39;packet_rate&#39;] = packet_count</span>
<span class="s1">                    packet_count = 0</span>
<span class="s1">                    last_update = current_time</span>
<span class="s1">                </span>
<span class="s1">                # Simulate ML prediction (every 10 packets)</span>
<span class="s1">                if self.stats[&#39;packets_processed&#39;] % 10 == 0:</span>
<span class="s1">                    self._simulate_prediction()</span>
<span class="s1">                </span>
<span class="s1">                # Print status every 100 packets</span>
<span class="s1">                if self.stats[&#39;packets_processed&#39;] % 100 == 0:</span>
<span class="s1">                    self._print_status()</span>
<span class="s1">        </span>
<span class="s1">        except KeyboardInterrupt:</span>
<span class="s1">            logger.info(&quot;Simulation stopped by user&quot;)</span>
<span class="s1">        except Exception as e:</span>
<span class="s1">            logger.error(f&quot;Error in simulation: </span><span class="si">{e}</span><span class="s1">&quot;)</span>
<span class="s1">        finally:</span>
<span class="s1">            self.running = False</span>
<span class="s1">    </span>
<span class="s1">    def _simulate_prediction(self):</span>
<span class="s1">        &quot;&quot;&quot;Simulate ML prediction&quot;&quot;&quot;</span>
<span class="s1">        # Simulate normal traffic 95</span><span class="si">% o</span><span class="s1">f the time</span>
<span class="s1">        if np.random.random() &gt; 0.05:</span>
<span class="s1">            return</span>
<span class="s1">        </span>
<span class="s1">        # Simulate anomaly</span>
<span class="s1">        self.stats[&#39;anomalies_detected&#39;] += 1</span>
<span class="s1">        </span>
<span class="s1">        attack_types = [&#39;DDoS&#39;, &#39;PortScan&#39;, &#39;BruteForce&#39;, &#39;Malware&#39;]</span>
<span class="s1">        severity_levels = [&#39;LOW&#39;, &#39;MEDIUM&#39;, &#39;HIGH&#39;, &#39;CRITICAL&#39;]</span>
<span class="s1">        </span>
<span class="s1">        attack = np.random.choice(attack_types)</span>
<span class="s1">        severity = np.random.choice(severity_levels, p=[0.4, 0.3, 0.2, 0.1])</span>
<span class="s1">        confidence = np.random.uniform(0.7, 0.95)</span>
<span class="s1">        </span>
<span class="s1">        # Log the alert</span>
<span class="s1">        alert_msg = (</span>
<span class="s1">            f&quot;🚨 ALERT: </span><span class="si">{attack}</span><span class="s1"> detected | &quot;</span>
<span class="s1">            f&quot;Severity: </span><span class="si">{severity}</span><span class="s1"> | &quot;</span>
<span class="s1">            f&quot;Confidence: </span><span class="si">{confidence:.2%}</span><span class="s1"> | &quot;</span>
<span class="s1">            f&quot;Source: 10.0.{np.random.randint(0,255)}.{np.random.randint(1,255)}&quot;</span>
<span class="s1">        )</span>
<span class="s1">        </span>
<span class="s1">        logger.warning(alert_msg)</span>
<span class="s1">        </span>
<span class="s1">        # Also print to console</span>
<span class="s1">        colors = {</span>
<span class="s1">            &#39;CRITICAL&#39;: &#39;</span><span class="se">\\</span><span class="s1">033[91m&#39;,  # Red</span>
<span class="s1">            &#39;HIGH&#39;: &#39;</span><span class="se">\\</span><span class="s1">033[93m&#39;,      # Yellow</span>
<span class="s1">            &#39;MEDIUM&#39;: &#39;</span><span class="se">\\</span><span class="s1">033[96m&#39;,    # Cyan</span>
<span class="s1">            &#39;LOW&#39;: &#39;</span><span class="se">\\</span><span class="s1">033[92m&#39;        # Green</span>
<span class="s1">        }</span>
<span class="s1">        </span>
<span class="s1">        color = colors.get(severity, &#39;</span><span class="se">\\</span><span class="s1">033[0m&#39;)</span>
<span class="s1">        reset = &#39;</span><span class="se">\\</span><span class="s1">033[0m&#39;</span>
<span class="s1">        </span>
<span class="s1">        print(f&quot;</span><span class="se">\\</span><span class="s1">n</span><span class="si">{color}</span><span class="s1">{&#39;=&#39;*60}</span><span class="si">{reset}</span><span class="s1">&quot;)</span>
<span class="s1">        print(f&quot;</span><span class="si">{color}</span><span class="s1">🚨 INTRUSION DETECTED!</span><span class="si">{reset}</span><span class="s1">&quot;)</span>
<span class="s1">        print(f&quot;</span><span class="si">{color}</span><span class="s1">Attack Type: </span><span class="si">{attack}{reset}</span><span class="s1">&quot;)</span>
<span class="s1">        print(f&quot;</span><span class="si">{color}</span><span class="s1">Severity: </span><span class="si">{severity}{reset}</span><span class="s1">&quot;)</span>
<span class="s1">        print(f&quot;</span><span class="si">{color}</span><span class="s1">Confidence: </span><span class="si">{confidence:.2%}{reset}</span><span class="s1">&quot;)</span>
<span class="s1">        print(f&quot;</span><span class="si">{color}</span><span class="s1">{&#39;=&#39;*60}</span><span class="si">{reset}</span><span class="se">\\</span><span class="s1">n&quot;)</span>
<span class="s1">        </span>
<span class="s1">        # Save to alert log</span>
<span class="s1">        self._log_alert(attack, severity, confidence)</span>
<span class="s1">    </span>
<span class="s1">    def _log_alert(self, attack_type, severity, confidence):</span>
<span class="s1">        &quot;&quot;&quot;Log alert to file&quot;&quot;&quot;</span>
<span class="s1">        alert_entry = {</span>
<span class="s1">            &#39;timestamp&#39;: datetime.now().isoformat(),</span>
<span class="s1">            &#39;attack_type&#39;: attack_type,</span>
<span class="s1">            &#39;severity&#39;: severity,</span>
<span class="s1">            &#39;confidence&#39;: float(confidence),</span>
<span class="s1">            &#39;packets_processed&#39;: self.stats[&#39;packets_processed&#39;]</span>
<span class="s1">        }</span>
<span class="s1">        </span>
<span class="s1">        try:</span>
<span class="s1">            with open(&#39;logs/alerts.json&#39;, &#39;a&#39;) as f:</span>
<span class="s1">                f.write(json.dumps(alert_entry) + &#39;</span><span class="se">\\</span><span class="s1">n&#39;)</span>
<span class="s1">        except Exception as e:</span>
<span class="s1">            logger.error(f&quot;Error writing alert: </span><span class="si">{e}</span><span class="s1">&quot;)</span>
<span class="s1">    </span>
<span class="s1">    def _print_status(self):</span>
<span class="s1">        &quot;&quot;&quot;Print current status&quot;&quot;&quot;</span>
<span class="s1">        elapsed = time.time() - self.stats[&#39;start_time&#39;]</span>
<span class="s1">        rate = self.stats[&#39;packets_processed&#39;] / elapsed if elapsed &gt; 0 else 0</span>
<span class="s1">        </span>
<span class="s1">        status = (</span>
<span class="s1">            f&quot;</span><span class="se">\\</span><span class="s1">n{&#39;=&#39;*50}</span><span class="se">\\</span><span class="s1">n&quot;</span>
<span class="s1">            f&quot;ML-IDS STATUS</span><span class="se">\\</span><span class="s1">n&quot;</span>
<span class="s1">            f&quot;{&#39;=&#39;*50}</span><span class="se">\\</span><span class="s1">n&quot;</span>
<span class="s1">            f&quot;Packets Processed: </span><span class="si">{self.stats[&#39;packets_processed&#39;]:,}</span><span class="se">\\</span><span class="s1">n&quot;</span>
<span class="s1">            f&quot;Anomalies Detected: </span><span class="si">{self.stats[&#39;anomalies_detected&#39;]}</span><span class="se">\\</span><span class="s1">n&quot;</span>
<span class="s1">            f&quot;Current Rate: </span><span class="si">{self.stats[&#39;packet_rate&#39;]}</span><span class="s1"> packets/sec</span><span class="se">\\</span><span class="s1">n&quot;</span>
<span class="s1">            f&quot;Average Rate: </span><span class="si">{rate:.1f}</span><span class="s1"> packets/sec</span><span class="se">\\</span><span class="s1">n&quot;</span>
<span class="s1">            f&quot;Uptime: </span><span class="si">{elapsed:.1f}</span><span class="s1"> seconds</span><span class="se">\\</span><span class="s1">n&quot;</span>
<span class="s1">            f&quot;{&#39;=&#39;*50}&quot;</span>
<span class="s1">        )</span>
<span class="s1">        </span>
<span class="s1">        print(status)</span>
<span class="s1">        logger.info(f&quot;Status: </span><span class="si">{self.stats[&#39;packets_processed&#39;]}</span><span class="s1"> packets, &quot;</span>
<span class="s1">                   f&quot;</span><span class="si">{self.stats[&#39;anomalies_detected&#39;]}</span><span class="s1"> anomalies&quot;)</span>
<span class="s1">    </span>
<span class="s1">    def stop(self):</span>
<span class="s1">        &quot;&quot;&quot;Stop the IDS&quot;&quot;&quot;</span>
<span class="s1">        self.running = False</span>
<span class="s1">        logger.info(&quot;IDS service stopped&quot;)</span>

<span class="s1">async def main():</span>
<span class="s1">    &quot;&quot;&quot;Main function&quot;&quot;&quot;</span>
<span class="s1">    print(&quot;</span><span class="se">\\</span><span class="s1">n&quot; + &quot;=&quot;*60)</span>
<span class="s1">    print(&quot;ML-IDS SIMPLE TEST SYSTEM&quot;)</span>
<span class="s1">    print(&quot;=&quot;*60)</span>
<span class="s1">    print(&quot;This is a test version that simulates network traffic.&quot;)</span>
<span class="s1">    print(&quot;Press Ctrl+C to stop.&quot;)</span>
<span class="s1">    print(&quot;=&quot;*60 + &quot;</span><span class="se">\\</span><span class="s1">n&quot;)</span>
<span class="s1">    </span>
<span class="s1">    # Initialize IDS</span>
<span class="s1">    ids = SimpleMLIDS()</span>
<span class="s1">    </span>
<span class="s1">    try:</span>
<span class="s1">        # Start simulation</span>
<span class="s1">        await ids.simulate_packets()</span>
<span class="s1">    except KeyboardInterrupt:</span>
<span class="s1">        print(&quot;</span><span class="se">\\</span><span class="s1">n</span><span class="se">\\</span><span class="s1">nStopping IDS...&quot;)</span>
<span class="s1">    except Exception as e:</span>
<span class="s1">        print(f&quot;</span><span class="se">\\</span><span class="s1">nError: </span><span class="si">{e}</span><span class="s1">&quot;)</span>
<span class="s1">    finally:</span>
<span class="s1">        ids.stop()</span>
<span class="s1">        </span>
<span class="s1">        # Print final stats</span>
<span class="s1">        elapsed = time.time() - ids.stats[&#39;start_time&#39;]</span>
<span class="s1">        print(&quot;</span><span class="se">\\</span><span class="s1">n&quot; + &quot;=&quot;*60)</span>
<span class="s1">        print(&quot;FINAL STATISTICS&quot;)</span>
<span class="s1">        print(&quot;=&quot;*60)</span>
<span class="s1">        print(f&quot;Total packets: </span><span class="si">{ids.stats[&#39;packets_processed&#39;]:,}</span><span class="s1">&quot;)</span>
<span class="s1">        print(f&quot;Anomalies detected: </span><span class="si">{ids.stats[&#39;anomalies_detected&#39;]}</span><span class="s1">&quot;)</span>
<span class="s1">        print(f&quot;Total time: </span><span class="si">{elapsed:.1f}</span><span class="s1"> seconds&quot;)</span>
<span class="s1">        print(f&quot;Average rate: {ids.stats[&#39;packets_processed&#39;]/elapsed:.1f} packets/sec&quot;)</span>
<span class="s1">        print(&quot;=&quot;*60)</span>
<span class="s1">        print(&quot;</span><span class="se">\\</span><span class="s1">nCheck logs/alerts.json for detected anomalies.&quot;)</span>
<span class="s1">        print(&quot;=&quot;*60)</span>

<span class="s1">if __name__ == &quot;__main__&quot;:</span>
<span class="s1">    asyncio.run(main())</span>
<span class="s1">&#39;&#39;&#39;</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;simple_ids.py&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ids_service_content</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;✓ Created: simple_ids.py (test version)&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../setup_ml_ids.html#setup_ml_ids.main">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main setup function&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ML-IDS COMPLETE SETUP&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create directories</span>
        <span class="n">create_directories</span><span class="p">()</span>
        
        <span class="c1"># Create config files</span>
        <span class="n">create_config_file</span><span class="p">()</span>
        
        <span class="c1"># Create ML model</span>
        <span class="k">if</span> <span class="n">create_dummy_model</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">✅ ML Model created successfully!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">⚠️  Could not create ML model, but continuing setup...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Create Python modules</span>
        <span class="n">create_python_modules</span><span class="p">()</span>
        
        <span class="c1"># Create simple IDS service</span>
        <span class="n">create_simple_ids_service</span><span class="p">()</span>
        
        <span class="n">print_header</span><span class="p">(</span><span class="s2">&quot;SETUP COMPLETE!&quot;</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📋 NEXT STEPS:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Test the system:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   python3 simple_ids.py&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;2. If that works, try the full version:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   python3 ids_service.py&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3. Configure Telegram alerts (optional):&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Edit config/config.yaml and add your bot token/chat ID&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4. Run dashboard:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   streamlit run dashboard_streamlit.py&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">❌ Setup failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2026, Rama Abu-Haweleha.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>